# Тестовое задание для отбора на Летнюю ИТ-школу КРОК по разработке

## Условие задания
Будучи сотрудником департамента внутренней автоматизации одной IT компании, вы занимаетесь разработкой и интеграцией различных решений с целью автоматизации различных внутренних бизнес процессов компании. Так, например, в свое время в вашем департаменте была разработана система учета проектных трудозатрат.

Идеологически такая система содержит функциональность по вводу и работе со сведениями о проектах и, самое главное, управление фактическими трудозатратами – списаниями времени. Это значит, что при выполнении той или иной проектной задачи сотрудник фиксирует затраченное на решение задачи время в данной системе. В результате менеджмент проектов может оценивать потраченное время и, как следствие, деньги на реализацию проекта: по задачам, этапам и любому другому уровню детализации.

Что еще важно знать о списаниях времени. У каждого сотрудника компании есть норма списания - количество времени, которое необходимо списывать за рабочий день. В общем случае (и в рамках задачи делаем допущение, что во всех случаях) такая норма составляет 8 часов в день. Однако сотрудники по тем или иным причинам могут списывать как больше 8 часов, так и меньше, в результате чего образуется дизбаланс. 

В первом случае можно говорить о том, что сотрудник перегружен или тратит на задачи больше времени, чем планируется, но, желая успеть в срок, задерживается на работе. Во втором случае причиной может быть как простой (отсутствие задач), так и недоработки со стороны самого сотрудника. 

Дизбаланс списаний стал серьезно волновать руководителей производственных департаментов, поэтому было принято решение на регулярной основе мониторить дизбаланс и принимать соответствующие меры. Однако за неимением такого отчета в системе, руководство департамента обратилось к вам с просьбой реализовать MVP подобного отчета.

На текущий момент система управления содержит функцию выгрузки списаний “TSR-3” (присвоенный отчету код) за указанный период в следующем формате:

"_<id сотрудника в формате UUID> <Фамилия> <Имя> <Отчество> <Дата списания в формате dd.MM.YYYY> <количество часов>_"

При этом стоит учесть, что количество списаний сотрудником не ограничивается. Так, например, файл может выглядеть следующим образом:
```
a30b4d51-11b4-49b2-b356-466e92a66df7 Иванов Иван Иванович 16.05.2024 4
0f0ccd5e-cd46-462a-b92d-69a6ff147465 Петров Алексей Сергеевич 16.05.2024 6
a30b4d51-11b4-49b2-b356-466e92a66df7 Иванов Иван Иванович 16.05.2024 2.5
0f0ccd5e-cd46-462a-b92d-69a6ff147465 Петров Алексей Сергеевич 16.05.2024 2
a30b4d51-11b4-49b2-b356-466e92a66df7 Иванов Иван Иванович 16.05.2024 1.5
```

По данному примеру видно, что оба сотрудника (Петров А.С. и Иванов И.И.) списали за 16 мая каждый по 8 часов, но, скорее всего, в разные задачи.

Вам же необходимо разработать программу для анализа дизбаланса, технические требования к разработке которой содержат следующее:
1. На вход программа для анализа получает файл со списаниями report.txt за конкретную рабочую неделю. О формате файла известно следующее:
    - в первой строке файла указывается недельная норма списания на одного сотрудника (из расчета дневной нормы списания, равной 8 часам; например, 40 для пятидневной рабочей недели);
    - во всех последующих строках файла указывается перечень списаний сотрудников в формате отчета “TSR-3”. 
2. Программа определяет сотрудников, у которых дизбаланс списаний времени за неделю составляет более 10% в обе стороны;
3. Найденные сотрудники с дизбалансом по итогам работы программы записываются в текстовый файл result.txt в следующем виде:
  "_<Фамилия И.О.> <количество часов, составляющих дизбаланс, с указанием знака>_".
  Количество часов дизбаланса сопровождается знаками “+” и “–” в соответствии со следующими условиями:
    - для часов, которые идут сверх нормы, ставится знак “+”;
    - для часов, недостающих до нормы, ставится знак “–”.
4. В выходном файле сначала перечисляются сотрудники с отрицательным дизбалансом в алфавитном порядке, затем - сотрудники с положительным дизбалансом в алфавитном порядке.
5. Ручной ввод пути к файлу через интерактивный режим (посредством клавиатурного ввода) недопустим. Также эксплуатация программы не должна подразумевать какие-либо изменения программного кода с целью указания пути к файлам.

Примеры входного и выходного файлов приложены к настоящему техническому заданию.

## Автор решения
#### [Грачева Алёна Валерьевна](https://t.me/grachevalenaa)
## Описание реализации
Для выполнения данного задания было написано 4 класса.

### ru.croc.school_test.model.Employee
Класс Employee используется для хранения состояния сотрудника после чтения файла и корректного вывода в файл. Информация о UUID и датах списания в самом классе не использовалась, так как не нужна для вывода в файл.

|Поле|Тип| Описание                                                                       |
|:---|:--|:-------------------------------------------------------------------------------|
|lastName| `String` | Фамилия                                                                        |
|firstName| `String` | Имя                                                                            |
|nameByFather| `String` | Отчество                                                                       |
|hoursThisWeek| `double` | Суммарное количество списанных часов данного сотрудника                        |
|hoursImbalance| `double` | Дисбаланс списанных часов по сравнению с недельной нормой у данного сотрудника |

**Методы класса** (помимо конструктора, геттеров и сеттеров):

* **toString()**: Метод возвращает строку вида <Фамилия И.О.> <количество часов, составляющих дисбаланс, с указанием знака>.
* **increaseAmountOfHours(double hours)**: Метод увеличивает количество списанных за неделю часов у сотрудника.

### ru.croc.school_test.file_handler.FileHandler
Класс FileHandler используется для обработки файлов, включая чтение данных сотрудников из файла и запись обработанных данных обратно в файл.

|Поле|Тип| Описание                                              |
|:---|:--|:------------------------------------------------------|
|filePathToRead| `String` | Путь к входному файлу для чтения исходных данных      |
|filePathToWrite| `String` | Путь к выходному файлу для записи обработанных данных |

**Методы класса:** (помимо сеттеров)

* **readFile()**: Метод устанавливает недельную норму часов и читает данные сотрудников из файла, указанного в filePathToRead. Он парсит каждую строку для извлечения данных о сотрудниках и сохраняет их в мапу, где ключом является UUID, а значением - объект класса Employee. Если UUID сотрудника уже есть в мапе, то увеличиваются его списанные часы. В конце метод возвращает список уникальных сотрудников.
* **writeFile(List<Employee> list)**: Метод принимает в качестве параметра список сотрудников, вызывает метод сортировки и записывает результат в файл, указанный в filePathToWrite.

### ru.croc.school_test.data_analyzer.DataAnalyzer
Класс DataAnalyzer используется для анализа рабочего времени сотрудников: определения дисбаланса рабочих часов по сравнению с недельной нормой и сортировки сотрудников согласно техническому заданию.

|Поле|Тип|Описание|
|:---|:--|:-------|
|idealAmountOfHours| `int` |Недельная норма рабочих часов, рассчитываемая из предположения 8-часового рабочего дня|
|IMBALANCE_PORTION| `double` |Пороговй дисбаланс рабочих часов, который равен 0.1 по ТЗ|

**Методы класса:** (помимо сеттера)

* **analyzeAmountOfHours(List<Employee> employees)**: Метод анализирует список сотрудников и возвращает список тех, чьи рабочие часы отличаются от недельной нормы строго больше 10%. Метод рассчитывает дисбаланс рабочих часов каждого сотрудника и возвращает тех, кто превышает установленный порог.
* **sortEmployees(List<Employee> employees)**: Метод сортирует поданный в качестве параметра список сотрудников по следующему принципу: сначала в списке располагаются сотрудники с отрицательным дисбалансом в алфавитном порядке, после них - сотрудники с положительным дисбалансом в алфавитном порядке. Алфавитный порядок работает по принципу "слово за словом": по первой букве фамилии, при совпадении первой буквы - по второй букве и так далее, при совпадении фамилии упорядочивание происходит по имени и так далее. При полном совпадении слов также влияние оказывает длина строки (Петров раньше, чем Петрова).

### ru.croc.school_test.Main
Класс Main является точкой входа в программу. Он координирует чтение данных о сотрудниках, их анализ и последующую запись обработанных данных.

**Метод класса:**

* **pulbic static void main(String[] args)** Главный метод приложения, который выполняет следующие шаги:
    * Считывает пути к файлам для чтения и записи из аргументов командной строки.
    * Устанавливает пути файлов в FileHandler.
    * Вызывает метод чтения данных класса FileHandler.
    * Вызывает метод класса DataAnalyzer для анализа рабочих часов сотрудников на предмет дисбаланса более 10%.
    * Вызывает метод записи обработанных данных о сотрудниках в файл класса FileHandler.
## Инструкция по сборке и запуску решения
Вам потребуется java не ниже 17 версии.  
Для запуска вы можете скачать [school-test.jar](https://github.com/grachevalenaa/school2024-test-task6/blob/master/school-test.jar), который располагается по адресу:
```bash
https://github.com/grachevalenaa/school2024-test-task6/blob/master/school-test.jar
```
Затем вам необходимо, перейти в папку с jar архивом, поместить в эту папку входной файл с данными и выходной файл для вывода результата (необязательно пустой) и прописать следующую команду:
```bash
java -jar school-test.jar <входной файл> <выходной файл>
```
Например, так:
```bash
java -jar school-test.jar report.txt result.txt
```
Можно использовать абсолютные пути:
```bash
java -jar /your/directrory/school-test.jar /another/directory/report.txt /another/directory/result.txt
```
Один и тот же файл можно использовать в качестве выходного для проверки разных входных тестовых данных.